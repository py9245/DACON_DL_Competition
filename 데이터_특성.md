# 파주시 소비 예측 데이터 통합 및 모델링 계획

## 폴더별 데이터 개요

### 국내_여행자_특성
- 파일 예시: `CI_DMSTC_PASSNGR_CHARTR_INFO_202401.csv`, `…_202402.csv`, `…_202403.csv` (총 21개, 월별)
- 관측 단위: 조사월 × 응답자 특성 구분 (성별, 연령대, 가구소득, 직업 등)
- 주요 필드: `EXAMIN_YM`, `RESPOND_CHARTR_SDIV_ID`, `RESPOND_CHARTR_SDIV_NM`, `RSPNS_RATE`
- 특징: `RSPNS_RATE`는 각 특성 그룹의 비중(%)이며 값 범위는 0~100. 응답 특성은 약 40개 수준.

### 국내_여행지역_관심도
- 파일 예시: `CI_DMSTC_TOUR_AREA_INTRST_DGREE_INFO_20240101.csv`, `…_20240212.csv`, `…_20240326.csv` (주간 단위 40여 개)
- 관측 단위: 조사 주차 × 응답자
- 주요 필드: `RESPOND_ID`, `EXAMIN_BEGIN_DE`, 성별/연령/소득, `ANSWRR_OC_AREA_NM`
- 지역별 관심도 컬럼: `SU_TOUR_INTRST_VALUE`, `GG_IC_TOUR_INTRST_VALUE` 등 8개 권역, 응답 값은 “약간 커졌다/비슷하다/줄었다” 등 서술형
- 특징: 1회 조사당 약 250행. 개별 응답 수준이라 월별/권역별 평균, 증가율 등을 산출 가능.

### 국내여행TOP10트랜드데이터결과
- 파일 예시: `DM_DMSTC_TOUR_TOP10_TREND_DATA_RESULT_20240101.csv` ~ `…_20240131.csv` (일별)
- 관측 단위: 일자 × 검색어 순위
- 주요 필드: `SRCHWRD_NM`, `UPPER_CTGRY_NM`, `AREA_NM`, `MOBILE_SCCNT_VALUE`, `PC_SCCNT_VALUE`, `SCCNT_SM_VALUE`, `SCCNT_DE`
- 특징: 일자별 상위 10개 키워드, 모바일/PC 검색량 포함. `AREA_NM`에 지역명이 있어 파주/경기 관련 키워드 필터링 가능.

### 여행_비용_지출_의향
- 파일 예시: `CI_TOUR_CT_EXPNDTR_INTEN_INFO_20240101.csv`, `…_20240219.csv`, `…_20240527.csv` (주간)
- 관측 단위: 조사 주차 × 응답자 (1회 약 500건)
- 주요 필드: `ALL_TURSM_TOUR_EXPNDTR_INTEN_VALUE`, `DMSTC_TURSM_TOUR_EXPNDTR_INTEN_VALUE`, `OVSEA_TURSM_TOUR_EXPNDTR_INTEN_VALUE`
- 특징: 응답 값은 “훨씬 더 많게/약간 적게/비슷하게” 등 서술형. 성별, 연령, 거주지, 가구소득 정보 포함.

### 여행_비용_지출_특성
- 파일 예시: `CI_TOUR_CT_EXPNDTR_CHARTR_INFO_20240101.csv`, `…_20240219.csv`, `…_20240527.csv`
- 관측 단위: 조사 주차 × 응답자 (1회 약 300건)
- 주요 필드: 총·숙박·식음료·교통·쇼핑 등 세부 지출 구간(`TOUR_TOT_CT_VALUE` 등), `TOUR_CTPRVN_NM`, `TOUR_SIGNGU_NM`, `TOUR_PD_VALUE`, 동행 인원, 인구통계
- 특징: 지출 구간은 “10~20만원 미만” 등 범주형, 일부 “모름” 포함.

## 단일 CSV 데이터 개요

| 파일명 | 크기 | 주요 필드 | 비고 |
|---|---|---|---|
| `1_생활인구분석_LG유플러스.csv` | 19×2 | `기준연월`, `생활인구수` | 2024.01~2025.07, 월별 총 생활인구 |
| `1_생활인구분석_경기데이터드림.csv` | 20×5 | `행정동명`, `거주인구`, `방문인구`, `근무인구`, `생활인구` | 행정동 단위 평균 인구 지표 |
| `3_관광지분석_LG유플러스.csv` | 23×3 | `연도`, `월`, `방문인구(명)` | 2023.09~2025.07 월별 방문객 |
| `3_관광지분석_삼성카드.csv` | 23×4 | `연도`, `월`, `매출금액(백만원)`, `매출건수(건)` | 월별 카드 매출, 예측 타깃 후보 |
| `4_관광지트렌드분석_LG유플러스.csv` | 2×2 | `연도`, `월평균 방문인구(명)` | 연도별 월평균 방문객 |
| `4_관광지트렌드분석_삼성카드.csv` | 5×3 | `연도`, `월평균 매출건수`, `월평균 매출금액` | 2021~2025 연도 단위 추세 |
| `5_식품위생업소소비분석_경기데이터드림.csv` | 20×2 | `행 레이블`, `합계(백만원)` | 행정동별 합계 소비(스냅샷) |
| `5_식품위생업소소비분석_삼성카드.csv` | 20×4 | `행정동명`, `식품위생업소수`, `음식점수`, `주점 및 비알코올 음료점업 수` | 행정동별 업소 수 |
| `6_소비경제규모추정.csv` | 20×12 | 행정동별 학령·생산 가능 인구, 인구활력지수 등 | 2023.01 vs 2025.07 비교 지표 및 증감률 |
| `경기도 파주시_지역화폐 발행및이용현황_20241106.csv` | 46×9 | `발행년월`, `월별카드발행수량`, `월별카드충전액`, `월별카드사용액` 등 | 2021.01~2024.06 월별 시군구 카드 이용 |
| `경기도 파주시_지역화폐 업종별이용현황_20241107.csv` | 138×10 | `기준년월`, 업종 대분류·세부, `카드사용액` | 업종 카테고리별 월별 카드사용 |

※ `데이터출처.txt`, `파주도시관광공사_문화시설현황_20220101.hwpx`는 요청에 따라 제외.

## 소비 예측용 데이터 합성 전략

### 라벨 정의
1. **기본 타깃**: `3_관광지분석_삼성카드.csv`의 월별 `매출금액(백만원)`을 활용해 “다음달 파주시 관광/소비 매출”을 예측.
2. **행정동 분해(synthetic)**: `5_식품위생업소소비분석_경기데이터드림.csv`의 행정동별 소비 합계를 비중으로 사용해 전체 월별 매출을 행정동 수준으로 분해하여 다운로드 가능한 지역별(읍면동) 타깃을 구성.
   - 행정동 가중치 \(w_d = \frac{\text{합계}_d}{\sum_d \text{합계}_d}\).
   - 월별 총매출 \(M_t\) → 행정동별 타깃 \(y_{d,t} = w_d \times M_t\).
3. **보조 타깃**: `지역화폐` 월별 `카드사용액`(전체/업종별)을 Multi-task 학습에 포함해 카드/관광 매출 간 상관관계 활용.

### 피처 엔지니어링
1. **정적 행정동 특성**
   - 업소 규모: `식품위생업소수`, `음식점수`, `주점업 수`.
   - 인구 구조: `거주/방문/근무/생활인구`, `학령/생산 가능 인구`, `인구활력지수` 증감률.
   - 정규화: 행정동 면적(추후 외부 데이터) 또는 전체 대비 비중으로 스케일링.
2. **월별(최근 3개월) 동적 피처**
   - 관광 매출/방문: `3_관광지분석_(LGU+, 삼성카드)`의 전월 대비 증감률, 계절성(월 sine/cosine), 이동평균.
   - 생활인구 총량: `1_생활인구분석_LG유플러스` → 행정동 가중치를 적용해 월별 생활인구 추정치 생성.
   - 지역화폐: `월별카드충전액`, `월별카드사용액` 및 업종별 사용액 합계/비중.
3. **주간 조사 → 월 집계**
   - `국내_여행지역_관심도`: 응답 문구 → 수치 매핑 (예: “훨씬 커졌다”: +2, “약간 커졌다”: +1, “비슷”: 0, “약간 줄었다”: -1, “많이 줄었다”: -2). `GG_IC_TOUR_INTRST_VALUE`를 중심으로 파주시와 연관된 경기도 관심지수 산출.
   - `여행_비용_지출_의향`: 동일 매핑으로 전체/국내/해외 지출 의향 지수 계산, 월 평균 및 증감률 파생.
   - `여행_비용_지출_특성`: 지출 구간을 중간값으로 매핑(예: “10~20만원 미만” → 15만원), “모름”은 NaN으로 처리 후 중앙값 대체. `TOUR_CTPRVN_NM == '경기도'` 필터로 지역 적합성 확보. 월평균 계획 지출액, 체류기간, 동행인원 등 산출.
4. **일별 키워드 집계**
   - `국내여행TOP10트랜드`에서 `AREA_NM`에 ‘경기’ 또는 여행 키워드 관련 항목만 필터.
   - 상위 키워드 등장 횟수, 총 검색량, 모바일 대비 PC 비율 등 월합계/평균 생성.
5. **시간 창 구조**
   - 입력 윈도우: 최근 3개월(월별) + 요약된 주간/일간 특징.
   - 목표 예측: 다음 1개월(`t+1`)의 행정동별 소비액.
   - 계절성·프로모션: 월(1~12), 분기, 공휴일 더미(외부 캘린더 결합) 추가.

### 데이터 전처리
1. **인코딩/클렌징**
   - 파일 인코딩: UTF-8-SIG (조사 데이터), CP949 (지역화폐) 구분해 로딩.
   - 텍스트 수치화: 위 매핑 테이블을 적용한 후 `StandardScaler` 또는 `RobustScaler`로 정규화.
   - 범주형: 행정동, 업종, 직업 등은 Target Encoding 또는 Embedding 입력을 위해 정수 인코딩.
2. **결측치 처리**
   - “모름/무응답”: NaN → 조사비율 기준으로 대체하거나 별도 범주.
   - 시계열 누락: 월별 지표가 비어 있는 경우 최근 3개월 평균으로 보간, 단 연속 결측 시 해당 표본 제외.
3. **정합성 체크**
   - 행정동명 매핑: 공백/옛 지명 통일 (예: ‘교하동’ ↔ ‘교하동(폐지)’ 등) 정규 표현식으로 정제.
   - 시간축: 모든 데이터프레임을 `Year-Month` 기준으로 inner join, 필요 시 lag feature 생성.
4. **학습/검증 분할**
   - 2023.09~2024.12 → 학습, 2025.01~2025.07 → 검증/테스트 (rolling-origin 방식).
   - 행정동 단위 K-fold(TimeSeriesSplit)로 성능 안정성 평가.

### 딥러닝 모델 제안
**Temporal Fusion Transformer (TFT)** 기반 다중 시계열 회귀
- 입력 구성:
  - 정적 카테고리 임베딩: 행정동, 업종 구성, 인구/업소 스냅샷.
  - 과거 관측: 월별 소비액, 카드사용액, 방문객, 생활인구, 관심도/지출 의향 지수, 키워드 지표.
  - 알려진 미래 피처: 달력 특성, 예정 이벤트(외부 일정 입력시).
- 하이퍼파라미터 (T4 16GB ×2, 5시간 내 학습 기준):
  - 히든 크기 128, LSTM 레이어 2, dropout 0.2
  - 최대 시퀀스 길이 4 (3개월 입력 + 1 예측), 배치 512, 학습률 5e-4, AdamW
  - Early stopping (patience=10, min_delta=1e-3), gradient clipping=1.0
  - PyTorch Lightning 멀티 GPU DDP 활용 → 50 epoch 내 수렴 예상
- 보조 모델: LightGBM/TabNet으로 피처 중요도 비교, 모델 스태킹 가능성 확인.

### 손실 함수 및 평가
- 기본: `SmoothL1Loss` + `L1` regularization (타깃 스케일 안정)
- 평가지표: MAE, RMSE, MAPE, SMAPE (소비액 예측에 적합)
- 업종별/행정동별 서브 그룹 성능 리포트로 편향 확인

### 학습 및 운영 플로우
1. **ETL 파이프라인** (Python + Pandas + PySpark(선택))
   - 원천 CSV ➜ 스테이징 (raw parquet)
   - 매핑/집계 ➜ feature store (월별, 행정동별 레벨)
2. **모델 학습**
   - Hydra/MLflow로 실험 관리, GPU 자원 스케줄링 (T4×2 병렬)
   - k-fold + rolling validation 결과 기록
3. **추론 & 배포**
   - 매월 최신 3개월 데이터로 피처 갱신 → 다음달 예측
   - 결과물: 행정동별 소비 예측치 + 90% 예측구간 (Quantile loss 추가 시)
4. **모니터링**
   - 실제 카드 매출 공개 시 실측치와 비교, drift 탐지 (Population Stability Index, Feature drift)
   - 관심도/지출 의향 등의 입력 분포도 시각화해 이상 탐지

### 추가 권장 사항
1. **데이터 확장**: 행정동 월별 실측 소비액이 확보되면 synthetic 분해 대신 직접 학습 가능.
2. **템포럴 피처 강화**: 기상, 이벤트(축제), 교통량 등 외부 데이터 결합으로 예측력 향상.
3. **AutoML 검증**: Darts, GluonTS 등 오픈소스 프레임워크로 baseline 비교.
4. **모델 해석**: TFT의 Feature importances, attention score 분석으로 정책 인사이트 제공.

---
본 계획은 제공된 5개 폴더와 CSV 전수(지정된 2개 파일 제외)를 기반으로 작성되었으며, 행정동별 소비 타깃 확보를 위해 가중치 기반 합성 전략을 전제로 한다. 추가 실측 데이터 확보 시 라벨링 및 피처 구성이 단순화될 수 있다.
